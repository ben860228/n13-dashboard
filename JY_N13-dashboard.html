<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N13å°ˆæ¡ˆæˆ°æƒ…å„€è¡¨æ¿</title>

    <link rel="icon" type="image/png" href="images/LOGO-NONAME-BLUE-ICON.png">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script
        src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script
        src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <link rel="stylesheet" href="css/style.css?v=20251224-fix">

    <script>
        window.PROJECT_CONFIG = {
            // N13 Config (Explicitly set to override defaults if needed, and add history)
            tasksUrl: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQiyY2STxHEAcJIa_wBeLHRYpGj82dozn-1tCo_ZhltPo-CABMaWOD88K7LLJnXTtW_3IV-k2qZq8HV/pub?gid=0&single=true&output=csv",
            infoUrl: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQiyY2STxHEAcJIa_wBeLHRYpGj82dozn-1tCo_ZhltPo-CABMaWOD88K7LLJnXTtW_3IV-k2qZq8HV/pub?gid=1735843667&single=true&output=csv",
            bulletinUrl: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQiyY2STxHEAcJIa_wBeLHRYpGj82dozn-1tCo_ZhltPo-CABMaWOD88K7LLJnXTtW_3IV-k2qZq8HV/pub?gid=479280600&single=true&output=csv",
            bulletinHistoryUrl: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQiyY2STxHEAcJIa_wBeLHRYpGj82dozn-1tCo_ZhltPo-CABMaWOD88K7LLJnXTtW_3IV-k2qZq8HV/pub?gid=704936196&single=true&output=csv"
        };
    </script>
</head>

<body>

    <div class="container">

        <div class="top-dashboard-wrapper">
            <div class="brand-sidebar">
                <a href="index.html" class="logo-block" style="text-decoration: none;" title="è¿”å›é¦–é ">
                    <img src="images/LOGO-WITHNAME-GREEN-SQUARE.png" alt="ç¶“ä¸€ç¶ èƒ½" class="company-logo">
                </a>
                <div class="project-image-block">
                    <!-- Project Image -->
                    <img src="images/JY_N13-LOGO-SQUARE.png" alt="N13å°ˆæ¡ˆåœ–ç‰‡" class="project-img-placeholder">
                </div>
            </div>

            <div class="card info-block">
                <div class="info-header">
                    <div class="title-col">
                        <h1 id="ui-project-name">è¼‰å…¥ä¸­...</h1>
                        <div class="sub-title">å°ˆæ¡ˆæˆ°æƒ…å„€è¡¨æ¿</div>
                    </div>
                    <div class="date-col">
                        <span id="currentDate"></span>
                        <!-- Status Msg inline -->
                        <span id="statusMsg" style="font-size:0.8em; margin-left:10px; color:#999;"></span>
                    </div>
                </div>

                <div class="key-people-row">
                    <div class="kp-item">
                        <span class="kp-label">å°ˆæ¡ˆä¸»ç®¡</span>
                        <span id="ui-boss" class="kp-value">--</span>
                    </div>
                    <div class="kp-item">
                        <span class="kp-label">è¡Œæ”¿è² è²¬äºº</span>
                        <span id="ui-process" class="kp-value">--</span>
                    </div>
                    <div class="kp-item">
                        <span class="kp-label">åœŸæœ¨è² è²¬äºº</span>
                        <span id="ui-civil" class="kp-value">--</span>
                    </div>
                    <div class="kp-item">
                        <span class="kp-label">æ©Ÿé›»è² è²¬äºº</span>
                        <span id="ui-mep" class="kp-value">--</span>
                    </div>
                </div>

                <div class="general-info-grid">
                    <div class="gi-item"><span class="gi-label">åœ°é»</span><span id="ui-location">--</span></div>
                    <div class="gi-item"><span class="gi-label">é›»å» åˆ†é¡</span><span id="ui-type">--</span></div>
                    <div class="gi-item"><span class="gi-label">ä¸»ç®¡æ©Ÿé—œ</span><span id="ui-government">--</span></div>
                    <div class="gi-item"><span class="gi-label">è¨­è¨ˆ</span><span id="ui-designer">--</span></div>
                    <div class="gi-item"><span class="gi-label">ç‡Ÿé€ </span><span id="ui-contractor">--</span></div>
                </div>
            </div>

            <div class="card stats-block">
                <div class="stat-row">
                    <div class="s-label">é å®šé€²åº¦</div>
                    <div class="s-value" id="plannedVal">--%</div>
                    <div class="s-sub" id="plannedDateStr">--/--/-- å·²æ›´æ–°</div>
                </div>
                <div class="stat-row">
                    <div class="s-label">å¯¦éš›é€²åº¦</div>
                    <div class="s-value" id="actualVal">--%</div>
                    <div class="s-sub" id="actualDateStr">--/--/-- å·²å›å ±</div>
                </div>
                <div class="stat-row">
                    <div class="s-label">å·®ç•°</div>
                    <div class="s-value" id="varianceVal">--%</div>
                    <span class="badge" id="varianceText">--</span>
                </div>
            </div>
        </div>

        <!-- â˜… New Bulletin Section â˜… -->
        <div class="card bulletin-block">
            <div class="panel-header-row">
                <div class="title-group">
                    <h3 class="panel-head">å°ˆæ¡ˆå…¬ä½ˆæ¬„</h3>
                    <span class="sub-note blue">(æœ€æ–°å›å ±)</span>
                </div>
            </div>
            <div id="bulletin-list" class="scrollable-list">
                <!-- Dynamic content will be loaded here -->
                <div style="text-align:center; padding: 20px; color:#999;">è¼‰å…¥ä¸­...</div>
            </div>
        </div>

        <div class="task-grid">
            <div class="task-panel ongoing-panel">
                <div class="panel-header-row">
                    <div class="title-group">
                        <h3 class="panel-head">é€²è¡Œä¸­ä»»å‹™</h3>
                        <span class="sub-note">(ç´…æ¡†è¡¨ç¤ºè½å¾Œ)</span>
                    </div>
                    <div class="category-legend">
                        <div class="legend-pair"><span class="legend-dot dot-admin"></span>è¡Œæ”¿</div>
                        <div class="legend-pair"><span class="legend-dot dot-design"></span>è¨­è¨ˆ</div>
                        <div class="legend-pair"><span class="legend-dot dot-const"></span>æ–½å·¥</div>
                    </div>
                </div>
                <div class="task-cols">
                    <div class="t-col">
                        <div class="col-title">è¡Œæ”¿</div>
                        <div id="ongoing-è¡Œæ”¿" class="t-list scrollable-list"></div>
                    </div>
                    <div class="t-col">
                        <div class="col-title">è¨­è¨ˆ</div>
                        <div id="ongoing-è¨­è¨ˆ" class="t-list scrollable-list"></div>
                    </div>
                    <div class="t-col">
                        <div class="col-title">æ–½å·¥ (åœŸæœ¨/æ©Ÿé›»)</div>
                        <div id="ongoing-æ–½å·¥" class="t-list scrollable-list"></div>
                    </div>
                </div>
            </div>

            <div class="task-panel upcoming-panel">
                <div class="panel-header-row">
                    <div class="title-group">
                        <h3 class="panel-head">å³å°‡ç™¼ç”Ÿ</h3>
                        <span class="sub-note blue">(æœªä¾† 14 å¤©)</span>
                    </div>
                </div>
                <div class="single-col-list scrollable-list">
                    <div id="upcoming-all"></div>
                </div>
            </div>
        </div>

        <div class="chart-section">
            <h3 id="sCurveHeader">å°ˆæ¡ˆ S-Curve</h3>
            <div class="chart-container">
                <canvas id="sCurveChart"></canvas>
            </div>
        </div>

        <div class="chart-section">
            <h3 id="ganttHeader" class="mb-0">å°ˆæ¡ˆæ•´é«”é€²åº¦ç”˜ç‰¹åœ–</h3>

            <div class="gantt-legend">
                <span class="legend-item"><span class="legend-color"
                        style="background-color: #27ae60;"></span>å·²å®Œæˆ</span>
                <span class="legend-item"><span class="legend-color"
                        style="background-color: #3498db;"></span>é€²è¡Œä¸­</span>
                <span class="legend-item"><span class="legend-color"
                        style="background-color: #f39c12;"></span>é€²è¡Œä¸­(è½å¾Œ)</span>
                <span class="legend-item"><span class="legend-color"
                        style="background-color: #ff0000;"></span>å°šæœªå•Ÿå‹•è€Œè½å¾Œ</span>
            </div>

            <div class="gantt-container">
                <canvas id="ganttChart"></canvas>
            </div>
        </div>

        <div class="footer-controls">
            <button class="simple-btn" onclick="loadFromGoogle()">ğŸ”„ é‡æ–°æ•´ç†</button>
            <button class="simple-btn" onclick="exportGanttToPDF()">ğŸ“„ åŒ¯å‡ºå ±è¡¨ (PDF)</button>
            <button class="link-btn" onclick="toggleManual()">æ‰‹å‹•è¼¸å…¥ CSV</button>
        </div>
        <div id="manualSection">
            <textarea id="csvInput" placeholder="è«‹è²¼ä¸Š CSV..."></textarea>
            <button class="simple-btn" onclick="parseManual()">ç¢ºèª</button>
        </div>
    </div>

    <!-- History Modal -->
    <div id="historyModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeHistoryModal()">&times;</span>
            <h3>ğŸ“œ ä¿®æ”¹æ­·å²ç´€éŒ„</h3>
            <div id="historyList" class="history-list"></div>
        </div>
    </div>

    <script src="js/pdfExport.js"></script>
    <script type="module" src="js/main.js"></script>
</body>

</html>